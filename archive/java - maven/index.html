<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="eclipse">
    <title>Bắt đầu với Maven</title>
    <link rel="icon" href="../../images/favicon.png">
    <link rel="stylesheet" href="../../css/style.css">
  </head>
  <body>
    <article>
      <h2>Bắt đầu với Maven</h2>
      <p>Maven thay cho cách quản lý các thư viện jar bằng tay. Có nhiều dự án
        gần 70 file jar mà chả biết file nào để làm gì.</p>
      <h3>Download và cài đặt</h3>
      <p>Download file ZIP ở địa chỉ sau:</p>
      <p><a href="https://maven.apache.org/download.cgi" target="_blank">https://maven.apache.org/download.cgi</a></p>
      <p>Việc cài đặt Maven đơn giản chỉ là giải nén file zip và thêm thư mục <code>bin</code>
        vào trong biến môi trường <code>PATH</code>.</p>
      <p>Sửa biến môi trường <code>PATH</code> ở file <code>/etc/profile</code>.
        Ví dụ:</p>
      <pre class="out-of-box">PATH=$PATH:/home/lockex1987/program/maven/bin:/home/lockex1987/program/node/bin<br>export PATH</pre>
      <p>Xác nhận kết quả của việc cài đặt với lệnh:</p>
      <pre>mvn -v</pre>
      <p>Kết quả mẫu là:</p>
      <pre>Apache Maven 3.3.9 (bb52d8502b132ec0a5a3f4c09453c07478323dc5; 2015-11-10T23:41:47+07:00)<br>Maven home: /data/program/maven
Java version: 1.8.0_60, vendor: Oracle Corporation
Java home: /usr/local/java/jre
Default locale: en_US, platform encoding: UTF-8
OS name: "linux", version: "3.16.0-38-generic", arch: "i386", family:          "unix"</pre>
      <h3>Cấu hình</h3>
      <p>Có một số cách để cấu hình Maven. Tuy nhiên cách thông thường nhất đó
        là sửa file <code>settings.xml</code> ở thư mục <code>~/.m2</code>,
        hoặc sửa file <code>settings.xml</code> ở thư mục <code>$MAVEN_HOME/conf</code>.</p>
      <p>Ví dụ:</p>
      <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"&gt;

    &lt;localRepository&gt;/data/program/maven/repository&lt;/localRepository&gt;

    &lt;pluginGroups&gt;&lt;/pluginGroups&gt;
    &lt;proxies&gt;&lt;/proxies&gt;
    &lt;servers&gt;&lt;/servers&gt;
    &lt;mirrors&gt;&lt;/mirrors&gt;

    &lt;profiles&gt;
        &lt;profile&gt;
            &lt;id&gt;downloadSources&lt;/id&gt;
            &lt;properties&gt;
                &lt;downloadSources&gt;true&lt;/downloadSources&gt;
                &lt;downloadJavadocs&gt;true&lt;/downloadJavadocs&gt;
            &lt;/properties&gt;
        &lt;/profile&gt;
    &lt;/profiles&gt;

    &lt;activeProfiles&gt;
        &lt;activeProfile&gt;downloadSources&lt;/activeProfile&gt;
    &lt;/activeProfiles&gt;
&lt;/settings&gt;</pre>
      <p>Trong ví dụ trên, chúng ta có cấu hình lại thư mục repository trên
        local. Chúng ta nên lưu nó ở thư mục dữ liệu (ổ D), không nên lưu ở thư
        mục cài đặt (ổ C) để mỗi lần cài lại hệ điều hành thì không bị mất.</p>
      <pre><code class="xml">&lt;localRepository&gt;/data/program/maven/repository&lt;/localRepository&gt;</code></pre>
      <h3>Tích hợp IDE </h3>
      <p>Chúng ta hãy thử tích hợp Maven với Eclipse.</p>
      <p>Chọn menu <code>Window -&gt; Preferences -&gt; Maven -&gt; User
          Settings</code>.</p>
      <p>Ở mục <code>Installations</code>, thêm một dòng <code>External Maven</code>
        và chọn dòng đó.</p>
      <div class="mb-3"><img src="images/maven-eclipse-installations.png" alt=""></div>
      <p>Ở mục <code>Global Settings</code> chọn lại đúng file. Mục <code>Local
          Repository</code> sẽ tự động được điều chỉnh.</p>
      <div class="mb-3"> <img alt="Maven Eclipse settings" src="images/maven-eclipse-settings.png">
      </div>
      <h3>Cấu trúc thư mục chuẩn</h3>
      <table class="table table-bordered">
        <tbody>
          <tr>
            <td><code>src/main/java</code></td>
            <td>Java code</td>
          </tr>
          <tr>
            <td><code>src/main/resources</code></td>
            <td>Các file cấu hình</td>
          </tr>
          <tr>
            <td><code>src/main/webapp</code></td>
            <td>Thư mục web</td>
          </tr>
          <tr>
            <td><code>src/test/java</code></td>
            <td>Unit test source</td>
          </tr>
          <tr>
            <td><code>src/test/resources</code></td>
            <td>Test resource</td>
          </tr>
          <tr>
            <td><code>pom.xml</code></td>
            <td>Project Object Model</td>
          </tr>
        </tbody>
      </table>
      <p>Ở ngoài cùng là file <code>pom.xml</code> và thư mục <code>src</code>.
        Ngoài ra có thể có file <code>LICENSE.txt</code>, <code>README.md</code>.</p>
      <h3>File pom.xml</h3>
      <p>File <code>pom.xml</code> là một file rất quan trọng.</p>
      <p>Một file <code>pom.xml</code> mẫu đặc trưng là:</p>
      <pre>&lt;project
        xmlns="http://maven.apache.org/POM/4.0.0"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;

    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;cttd&lt;/groupId&gt;
    &lt;artifactId&gt;&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;4.12&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;</pre>
      <p>Trong file <code>pom.xml</code> trên chúng ta sẽ có luôn các cấu hình
        là phiên bản Java, source encoding UTF-8, jUnit.</p>
      <p>Để chỉ định phiên bản Java, nếu sử dụng Spring Boot thì chỉ cấu hình:</p>
      <pre><code class="xml">&lt;properties&gt;
    &lt;java.version&gt;1.7&lt;/java.version&gt;
&lt;/properties&gt;</code></pre>
      <h3>Cấu hình proxy cho Maven</h3>
      <p>Ở máy cơ quan chẳng hạn, nhiều khi bạn không thể truy cập Internet trực
        tiếp mà phải qua proxy. Để thiết lập proxy cho Maven, hãy sửa file <code>settings.xml</code>
        như sau:</p>
      <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0
                            http://maven.apache.org/xsd/settings-1.0.0.xsd"&gt;
    &lt;proxies&gt;
        &lt;proxy&gt;
            &lt;active&gt;true&lt;/active&gt;
            &lt;protocol&gt;https&lt;/protocol&gt;
            &lt;host&gt;10.225.1.1&lt;/host&gt;
            &lt;port&gt;3128&lt;/port&gt;        
            &lt;username&gt;&lt;/username&gt;
            &lt;password&gt;&lt;/password&gt;    
        &lt;/proxy&gt;
    &lt;/proxies&gt;
&lt;/settings&gt;</pre>
      <h3>Các câu lệnh Maven</h3>
      <h4>mvn compile</h4>
      <p>Lần đầu tiên thực thi lệnh này, Maven sẽ download toàn bộ các plugin và
        các dependency liên quan. Nếu bạn thực thi lại lệnh này, Maven sẽ không
        download lại những gì nó đã có từ lần trước, vậy nên lệnh sẽ được thực
        thi nhanh hơn. Các class được compile sẽ được đưa vào <code>${basedir}/target/classes</code>.</p>
      <h4>mvn test</h4>
      <p>Bạn có một số unit test và bạn muốn compile và thực thi chúng, bạn chỉ
        cần sử dụng lệnh trên.</p>
      <h4>mvn test-compile</h4>
      <p>Nếu bạn chỉ muốn complie test source mà không muốn thực thi, bạn sử
        dụng lệnh trên.</p>
      <h4>mvn -Dtest=&lt;class&gt; test</h4>
      <p>Để chạy test 1 file test nào đó. Ví dụ:</p>
      <pre>mvn -Dtest=TestApp1 test
mvn -Dtest=TestApp2 test</pre>
      <h4>mvn package</h4>
      <p>Bạn muốn xuất project của mình ra file <code>jar</code> để sử dụng.
        Bạn xem lại file <code>pom.xml</code>, phần tử <code>packaging</code>
        phải có giá trị là <code>jar</code> (nếu là <code>war</code> thì Maven
        sẽ xuất ra file <code>war</code>). Sau đó, bạn sử dụng lệnh trên.</p>
      <p>Nếu bạn muốn bỏ qua test thì dùng lệnh:</p>
      <pre>mvn package -Dmaven.test.skip=true</pre>
      <h4>mvn install</h4>
      <p>Lệnh <code>mvn package</code> chỉ mới xuất ra file <code>jar</code>
        vào thư mục <code>${basedir}/target</code>. Để có thể đưa file <code>jar</code>
        vào trong local repository thực thi thêm lệnh trên.</p>
      <h4>mvn clean</h4>
      <p>Thư mục <code>target</code> sẽ bị xóa cùng với các dữ liệu trong đó
        trước khi project được làm mới.</p>
      <h4>mvn clean install</h4>
      <p>Khi muốn build project thành các file chạy <code>jar</code> hoặc <code>war</code>,
        người ta thường sử dụng đồng thời cả lệnh <code>mvn clean</code> và <code>install</code>.</p>
      <h4>mvn site</h4>
      <p>Tạo một document site cho project, hiển thị các thông tin liên quan đến
        project (ví dụ như các dependency, các plugin được sử dụng – khai báo
        trong pom) </p>
      <h4>mvn eclipse:eclipse</h4>
      <p>Nếu bạn sử dụng eclipse, lệnh này sẽ giúp project có thể dễ dàng import
        và sử dụng trên Eclipse.</p>
      <h4>mvn install</h4>
      <p>Nhiều khi file <code>jar</code> của không có trên Maven repository,
        hoặc là bạn tạo ra một file <code>jar</code> và muốn sử dụng cho dự án
        khác. Để cài đặt file <code>jar</code>.</p>
      <pre>mvn install:install-file
          -Dfile=QueryCrypt.jar
          -DgroupId=guhesan<br>          -DartifactId=querycrypt<br>          -Dversion=1.0
          -Dpackaging=jar<br>          -DgeneratePom=true<br>
mvn install:install-file<br>          -Dfile=target/cttd-core-1.0.jar
          -DgroupId=cttd<br>          -DartifactId=cttd-core
          -Dversion=1.0<br>          -Dpackaging=jar<br>          -DgeneratePom=true</pre>
      <h3>Tham khảo</h3>
      <p><a href="https://mvnrepository.com/" target="_blank">Maven Repository:
          Search/Browse/Explore</a></p>
    </article>
    <script src="../../js/docs.js"></script>
  </body>
</html>
