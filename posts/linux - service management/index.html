<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="systemctl, systemd, run at boot, keep alive">
    <title>Quản lý service</title>
    <link rel="icon" href="../../images/favicon.png">
    <link rel="stylesheet" href="../../css/style.css">
  </head>
  <body>
    <article>
      <h2>Quản lý service</h2>
      <p>Để quản lý các service trong Linux, chúng ta sử dụng lệnh <code>systemctl</code>.</p>
      <h3>Các lệnh cơ bản</h3>
      <p>Start service:</p>
      <pre>sudo systemctl start &lt;tên service&gt;</pre>
      <p>Stop service:</p>
      <pre>sudo systemctl stop &lt;tên service&gt;</pre>
      <p>Restart service:</p>
      <pre>sudo systemctl restart &lt;tên service&gt;</pre>
      <p>Reload service (load lại các file cấu hình)</p>
      <pre>sudo systemctl reload &lt;tên service&gt;</pre>
      <p>Enable service, để service tự động chạy khi khởi động máy:</p>
      <pre>sudo systemctl enable &lt;tên service&gt;</pre>
      <p>Disable service:</p>
      <pre>sudo systemctl disable &lt;tên service&gt;</pre>
      <p>Kiểm tra trạng thái service:</p>
      <pre>sudo systemctl status &lt;tên service&gt;</pre>
      <h3>Unit file</h3>
      <p>Unit file chứa các tham số mà systemd sử dụng để quản lý và chạy unit.</p>
      <p>Xem thông tin unit file:</p>
      <pre>sudo systemctl cat &lt;tên service&gt;</pre>
      <p>Xem các unit cần chạy khi khởi động:</p>
      <pre>sudo systemctl list-dependencies &lt;tên service&gt;</pre>
      <p>Thêm một option vào unit file:</p>
      <pre>sudo systemctl edit &lt;tên service&gt;</pre>
      <p>Sửa trực tiếp toàn bộ nội dung file:</p>
      <pre>sudo systemctl edit --full &lt;tên service&gt;</pre>
      <p>Reload lại systemd sau khi sửa:</p>
      <pre>sudo systemctl daemon-reload</pre>
      <h3>Tự tạo service</h3>
      <p>Chúng ta sẽ thử tạo một service và để nó tự động chạy khi khởi động
        máy.</p>
      <p>File service sẽ chạy script <code>test_service.sh</code> sau:</p>
      <pre>DATE=`date '+%Y-%m-%d %H:%M:%S'`
echo "Example service started at ${DATE}" | systemd-cat -p info

while :
do
echo "Looping...";
sleep 30;
done</pre>
      <p>Copy file script vào thư mục <code>/usr/bin</code>.</p>
      <pre>sudo cp test_service.sh /usr/bin/test_service.sh<br>sudo chmod +x /usr/bin/test_service.sh</pre>
      <p>Tạo unit file <code>/lib/systemd/system/myservice.service</code>:</p>
      <p>/etc/systemd/system/myservice.service</p>
      <pre>[Unit]
Description=Example systemd service

[Service]
Type=simple
ExecStart=/bin/bash /usr/bin/test_service.sh

[Install]
WantedBy=multi-user.target</pre>
      <p>Start và xem trạng thái:</p>
      <pre>sudo systemctl start myservice<br>sudo systemctl status myservice</pre>
      <p>TODO: Ảnh</p>
      <p>Enable service khi khởi động:</p>
      <pre>sudo systemctl enable myservice</pre>
      <p>Để service tự động khởi động lại khi bị lỗi, chúng ta thêm các tham số
        sau vào unit file:</p>
      <pre>Restart=always<br>RestartSec=1</pre>
      <h3>Tham khảo</h3>
      <p><a href="https://viblo.asia/p/su-dung-systemd-de-chinh-sua-service-linux-m68Z0PJNZkG"
          target="_blank">Sử dụng systemd để chỉnh sửa service linux</a></p>
      <p><a href="https://viblo.asia/p/tim-hieu-va-van-dung-systemd-de-quan-ly-he-thong-linux-phan-co-ban-WAyK8kN65xX"
          target="_blank">Tìm hiểu và vận dụng systemd để quản lý hệ thống Linux
          (phần cơ bản)</a> </p>
      <p><a href="https://viblo.asia/p/java-chay-file-jar-nhu-mot-service-tren-linux-07LKX4pEKV4"
          target="_blank">[Java] Chạy file .jar như một service trên linux</a> </p>
      <p><a href="https://www.linode.com/docs/guides/introduction-to-systemctl/"
          target="_blank">Introduction to systemctl | Linode</a></p>
      <p><a href="https://www.linode.com/docs/guides/start-service-at-boot/" target="_blank">Use
          systemd to Start a Linux Service at Boot | Linode</a></p>
    </article>
    <script src="../../js/docs.js"></script>
  </body>
</html>
