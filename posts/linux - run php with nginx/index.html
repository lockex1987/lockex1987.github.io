<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="date" content="2020-02-20 22:24:00">
    <meta name="description" content="php-fpm">
    <title>Chạy PHP với nginx</title>
    <link rel="icon" href="../../images/favicon.png">
    <link rel="stylesheet" href="../../css/style.css">
  </head>
  <body>
    <article>
      <h2>Chạy PHP với nginx</h2>
      <p>Nginx hỗ trợ các module để giao tiếp với các trình xử lý PHP như
        FastCGI. Bài viết này sẽ hướng dẫn bạn cài đặt nginx chạy php-fpm trên
        Ubuntu.</p>
      <h3>Cài đặt</h3>
      <p>Đầu tiên phải cài PHP. Xem hướng dẫn <a href="https://lockex1987.github.io/posts/linux%20-%20install%20php/">ở
          đây</a>. Chú ý cài extension php-fpm. Php-fpm nghĩa là <strong>PHP</strong>
        <strong>F</strong>astCGI <strong>p</strong>rocess <strong>m</strong>anager.</p>
      <p>Tiếp theo cài nginx. Xem hướng dẫn <a href="../linux%20-%20install%20nginx/index.html">ở
          đây</a>.</p>
      <p>Tiếp theo cài php-fpm: </p>
      <pre>sudo apt install php8.0-fpm</pre>
      <p>Kiểm tra: </p>
      <pre>sudo systemctl status php8.0-fpm

sudo systemctl start php8.0-fpm
sudo systemctl stop php8.0-fpm
sudo systemctl restart php8.0-fpm

sudo systemctl enable php8.0-fpm</pre>
      <h3>Cấu hình</h3>
      <p>Bây giờ bạn cần phải cấu hình nginx để chạy PHP thông qua php-fpm. </p>
      <p>Để cấu hình nginx chạy php-fpm, bạn cần phải chỉnh sửa file config <code>/etc/nginx/conf.d/default.conf</code>
        như sau:</p>
      <pre class="out-of-box">server {
    listen 80;
    listen 443;<br>
    server_name localhost;<br>
    root /usr/share/nginx/html;<br>
    index index.php index.html;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_split_path_info    ^(.+\.php)(/.+)$;
        fastcgi_pass               unix:/var/run/php/php8.0-fpm.sock;
        # fastcgi_pass               127.0.0.1:9000;
        fastcgi_index              index.php;
        fastcgi_param              SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        # fastcgi_param              SCRIPT_FILENAME  $realpath_root$fastcgi_script_name;
        include                    fastcgi_params;
    }
}</pre>
      <p>Chú ý chỉnh lại đường dẫn <code>fastcgi_pass</code> cho đúng thực tế.</p>
      <h3>Kiểm tra</h3>
      <p>Để kiểm tra xem bạn đã chạy được nginx sử dụng php-fpm hay chưa, bạn
        chỉ cần xem thông tin phpinfo của máy chủ.</p>
      <p>Tạo một file<code> test.php</code> trong thư mục root của bạn:</p>
      <pre>vi /var/www/html/test.php</pre>
      <p>Nội dung của file:</p>
      <pre>&lt;?php<br>phpinfo();</pre>
      <p>Bây giờ truy cập vào <a href="http://localhost/test.php" target="_blank">http://localhost/test.php</a>
        và kiểm tra, nếu bạn thấy trong phần "Server API" là "FPM/FastCGI" thì
        bạn đã thành công.</p>
    </article>
    <script src="../../js/docs.js"></script>
  </body>
</html>
