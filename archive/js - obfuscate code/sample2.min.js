var filterPosts,lunrIndex,curentPostIndex=0,isLoadingMorePosts=!1;function initSearch(){lunrIndex=lunr(function(){this.ref("id"),this.field("path",{boost:8}),this.field("title",{boost:10}),this.field("description"),allPosts.forEach((e,t)=>{e.id=t,this.add(e)})})}function updateThumbnailImage(){const e={eclipse:"eclipse.png",git:"git.svg",linux:"linux.svg",spring:"spring.png",vue:"vue.png",angularjs:"angularjs.svg",bootstrap:"bootstrap.svg",grunt:"grunt.svg",javascript:"javascript.svg",bulma:"bulma.png",gulp:"gulp.svg",java:"java.svg",maven:"maven.png",chartjs:"chartjs.svg",jquery:"jquery.svg",python:"python.svg",css:"css3.svg",ui:"css3.svg",mysql:"mysql.svg",redis:"redis.svg",vscode:"vscode.png",django:"django.svg",github:"github.svg",web:"html5.svg",webext:"html5.svg",less:"less.svg",nodejs:"nodejs.svg",other:"other.png",story:"story.png",pwa:"pwa.svg",laravel:"laravel.svg",highcharts:"highcharts.png",highmaps:"highcharts.png",project:"project.png",knowledge:"other.png",it:"other.png",php:"php.svg",elasticsearch:"elasticsearch.svg",docker:"docker.svg",cryptography:"cryptography.png",animation:"animation.png",cassandra:"cassandra.svg",node:"nodejs.svg",nginx:"nginx.svg",ckeditor:"ckeditor.png",game:"game.png",mongodb:"mongodb.png",riot:"riot.png",sass:"sass.png"};allPosts.forEach(t=>{t.thumb=e[t.category]||t.category+".png"})}function processFilterPosts(){var e=document.getElementById("query").value.toLowerCase();if(filterPosts=e?splitSearch(e):allPosts,document.getElementById("isBookmark").checked){var t=getBookmarks();filterPosts=filterPosts.filter(e=>t.includes(e.path))}curentPostIndex=0,document.querySelector(".list").innerHTML="",bindPosts()}function fullTextSearch(e){return lunrIndex.search(e).map(e=>{var t=e.ref;return allPosts[parseInt(t)]})}function splitSearch(e){var t=createSearchRegex(e),n=allPosts.filter(e=>{var n=10*countOccurrences(e.title,t)+8*countOccurrences(e.path,t)+5*countOccurrences(e.description,t);return n>0&&(e.occurrences=n,!0)});return n.sort((e,t)=>e.occurrences!=t.occurrences?t.occurrences-e.occurrences:e.path.localeCompare(t.path)),n}function createSearchRegex(e){return new RegExp("("+e.trim().split(" ").join("|")+")","gi")}function countOccurrences(e,t){return(e.match(t)||[]).length}function bindPosts(){var e=document.querySelector(".list");if(0!=filterPosts.length){if(!(curentPostIndex>=filterPosts.length)){isLoadingMorePosts=!0;var t=getBookmarks(),n=document.getElementById("query").value.toLowerCase(),o=createSearchRegex(n);filterPosts.slice(curentPostIndex,curentPostIndex+20).forEach((s,r)=>{var a=document.createElement("li");a.id=`post${curentPostIndex+r}`,a.innerHTML=`\n                    \x3c!--img class="thumb" src="images/${s.thumb}"/--\x3e\n                    <div class="info">\n                        <div>\n                            <img class="bookmark"\n                                    src="${t.includes(s.path)?"images/bookmark-solid.svg":"images/bookmark-regular.svg"}"\n                                    style="width:12px; cursor:pointer;"\n                                    onclick="toggleBookmarks(${curentPostIndex+r})"/>\n\n                            <a class="title" href="posts/${s.path}/" target="_blank">\n                                ${highlightText(s.title,o,n)}\n                            </a>\n                        </div>\n\n                        <div>\n                            <a class="path" href="posts/${s.path}/" target="_blank">\n                                ${highlightText(s.path,o,n)}\n                            </a>\n                        </div>\n                        \n                        <div class="description">\n                            ${highlightText(s.description,o,n,170)}\n                        </div>\n                    <div>`,e.appendChild(a)}),curentPostIndex+=20,isLoadingMorePosts=!1}}else e.innerHTML='<li style="color: #E06950">Không tìm thấy kết quả</li>'}function highlightText(e,t,n){return e.replace(t,'<span class="highlight">$1</span>')}function highlightText2(e,t,n,o){o=o||2*e.length;for(var s,r=n.split(" "),a=e.toLowerCase().indexOf(n.toLowerCase()),i=n.length,c=0;c<r.length&&!(a>=0);c++)a=e.toLowerCase().indexOf(r[c].toLowerCase()),i=r[c].length;if(a>=0){var l=a-o/2,g=l>0?a+i+o/2:o;s=e.substring(l,g).trim(),l>0&&(s="..."+s),g<e.length&&(s+="..."),s=s.replace(new RegExp("("+r.join("|")+")","gi"),"<strong>$1</strong>")}else s=e.substring(0,o).trim()+(e.length>o?"...":"");return s}function getBookmarks(){var e=localStorage.getItem("bookmarks");return e?JSON.parse(e):[]}function setBookmarks(e){localStorage.setItem("bookmarks",JSON.stringify(e))}function toggleBookmarks(e){var t=getBookmarks(),n=filterPosts[e].path,o=t.indexOf(n);o>=0?(t.splice(o,1),updateBookmarkIcon(e,!1)):(t.push(n),updateBookmarkIcon(e,!0)),setBookmarks(t)}function updateBookmarkIcon(e,t){document.querySelector("#post"+e+" .bookmark").src=t?"images/bookmark-solid.svg":"images/bookmark-regular.svg"}function normalizeCategories(){var e=[],t=[];return e.push({name:"other",y:0}),categories.forEach(n=>{n.y>=10?e.push(n):(e[0].y+=n.y,t.indexOf(n.name)<0&&t.push(n.name))}),e[0].name=t.slice(0,10).join(", ")+",...",e}function buildChart(){Highcharts.chart("chart",{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie",backgroundColor:"transparent"},title:{text:null},tooltip:{pointFormat:"{series.name}: <b>{point.y}</b> ({point.percentage:.1f}%)"},plotOptions:{pie:{dataLabels:{enabled:!1},showInLegend:!0}},credits:{enabled:!1},legend:{enabled:!1,align:"center",verticalAlign:"bottom",layout:"vertical"},series:[{name:"Số bài",colorByPoint:!0,data:normalizeCategories()}]})}function filterByCategory(e){document.getElementById("query").value=e,processFilterPosts()}function buildCategories(){var e=`\n        ${["Web","CSS","JavaScript","Bootstrap","Highcharts","Laravel","PHP","Java","Linux"].map(e=>`\n            <li class="cat">\n                <a href="javascript:" onclick="filterByCategory('${e.toLowerCase()}')">\n                    ${e}\n                </a>\n            </li>\n            `).join("")}\n        `;document.querySelector("#categories").innerHTML=`<ul style="list-style: none;">${e}</ul>`}function checkLoadMorePosts(){if(!isLoadingMorePosts){var e=document.body.scrollTop||document.documentElement.scrollTop;document.documentElement.scrollHeight-document.documentElement.clientHeight-e<100&&bindPosts()}}window.addEventListener("DOMContentLoaded",function(){try{updateThumbnailImage(),initSearch(),processFilterPosts(),buildCategories(),document.getElementById("query").focus(),window.addEventListener("scroll",checkLoadMorePosts),document.querySelector("#query").addEventListener("input",processFilterPosts),document.querySelector("#isBookmark").addEventListener("click",processFilterPosts)}catch(e){alert(e)}});