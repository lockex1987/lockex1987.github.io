<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="test automation, crawl các domain bằng Google theo từ khóa">
    <title>Hướng dẫn Selenium cơ bản</title>
    <link rel="icon" href="../../images/favicon.png">
    <link rel="stylesheet" href="../../css/style.css">
  </head>
  <body>
    <article>
      <h2>Hướng dẫn Selenium cơ bản</h2>
      <h3>Giới thiệu</h3>
      <p>Tìm hiểu xem Selenium (automation test) có thể làm được những gì.</p>
      <p>Selenium gồm các thành phần:</p>
      <ul>
        <li>WebDriver</li>
        <li>IDE</li>
        <li>Grid</li>
      </ul>
      <p>Selenium hỗ trợ các ngôn ngữ lập trình sau:</p>
      <ul>
        <li>Java</li>
        <li>Python</li>
        <li>C#</li>
        <li>Ruby</li>
        <li>JS (Node)</li>
        <li>Kotlin</li>
      </ul>
      <p><br>
      </p>
      <p>Tôi chọn JS để học cùng với Selenium.</p>
      <p>Phiên bản tôi sử dụng là:</p>
      <p>Selenium 3.141 (4.0.0-beta.4)</p>
      <p>Trình duyệt Chrome</p>
      <p>Ngôn ngữ lập trình JS (Node)</p>
      <p><br>
      </p>
      <p><br>
      </p>
      <h3>Bắt đầu</h3>
      <p>Download file driver dạng binary ở địa chỉ:</p>
      <p>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <a href="https://www.selenium.dev/downloads/" target="_blank">Downloads</a></p>
      <p>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <a href="https://sites.google.com/chromium.org/driver/" target="_blank">ChromeDriver
          - WebDriver for Chrome</a></p>
      <p>Chú ý:</p>
      <ul>
        <li>Bạn phải có sẵn trình duyệt tương ứng (Chrome, Firefox,...) cài ở
          máy</li>
        <li>Bạn phải chọn đúng phiên bản của driver và phiên bản trình duyệt ở
          máy bạn</li>
      </ul>
      <p>Cho file driver ở đường dẫn <code>PATH</code> của hệ điều hành. Trên
        môi trường Linux, nên cho vào đường dẫn <code>/home/&lt;Tên người
          dùng&gt;/.local/bin</code>.</p>
      <p>Kiểm tra:</p>
      <pre class="bg-dark text-white">$ chromedriver
Starting ChromeDriver 91.0.4472.101 (af52a90bf87030dd1523486a1cd3ae25c5d76c9b-refs/branch-heads/4472@{#1462}) on port 9515
Only local connections are allowed.
Please see https://chromedriver.chromium.org/security-considerations for suggestions on keeping ChromeDriver safe.
[1625915137,884][SEVERE]: bind() failed: Cannot assign requested address (99)
ChromeDriver was started successfully.</pre>
      <p><br>
      </p>
      <p><br>
      </p>
      <p>Sử dụng package <code>selenium-webdriver</code>:</p>
      <pre class="command-line">npm install selenium-webdriver</pre>
      <p>Một số source code của Selenium vẫn viết dạng module.exports cũ (ví dụ
        selenium-webdriver/chrome), không sử dụng import / export mới của ES6
        module. Do đó chúng ta vẫn sử dụng require.</p>
      <p>Để sử dụng import của ES6, bạn phải thêm cấu hình "type": "module" ở
        file package.json.</p>
      <p>Bạn không thể dùng lẫn require và import.</p>
      <p>File <code>01-get-started.js</code>:</p>
      <pre><code class="language-js">const { Builder } = require('selenium-webdriver');

async function getStarted() {
    const driver = await new Builder().forBrowser('chrome').build();
    const url = 'https://google.com';
    await driver.get(url);
}

getStarted();</code></pre>
      <p>Thực thi:</p>
      <pre class="command-line">node 01-get-started.js</pre>
      <p>Bạn sẽ thấy trình duyệt Chrome được bật và hiển thị trang web
        google.com.</p>
      <h3>Một số thao tác cơ bản<br>
      </h3>
      <p>Lấy tiêu đề, URL, source code của trang.</p>
      <p>Đóng trình duyệt.</p>
      <p>Chụp ảnh screenshot.</p>
      <p>Chạy headless, xuất file PDF.</p>
      <p>Phần lớn các phương thức đều trả về Promise. Hãy sử dụng async await.<br>
      </p>
      <p>Kích thước cửa sổ.</p>
      <h3>Navigate</h3>
      <p>Back, forward, refresh.</p>
      <h3>Sử dụng proxy<br>
      </h3>
      <p>Đang không được ở máy công ty.</p>
      <p>Mặc định sẽ sử dụng proxy của hệ thống. Thiết lập proxy của hệ thống là
        192.168.103.26:80 thì chạy được.</p>
      <h3>Đường dẫn driver</h3>
      <p>Để đường dẫn ở trong thư mục thuộc biến môi trường <code>PATH</code>
        của hệ điều hành.</p>
      <p>Nếu không thì cần cấu hình (trước khi khởi tạo driver):</p>
      <pre>x</pre>
      <p><br>
      </p>
      <h3>Select phần tử</h3>
      <p>ID</p>
      <p>Name</p>
      <p>Class</p>
      <p>CSS selector</p>
      <p>XPath</p>
      <p><br>
      </p>
      <p><br>
      </p>
      <h3>Phần tử WebElement</h3>
      <p>attribute</p>
      <p>text</p>
      <p>HTML</p>
      <h3>Keyboard</h3>
      <p>x</p>
      <p><br>
      </p>
      <h3>Thực hiện JS</h3>
      <p>x</p>
      <p><br>
      </p>
      <h3>Wait</h3>
      <p>x</p>
      <p><br>
      </p>
      <h3>Upload file</h3>
      <p>y</p>
      <h3>Iframe</h3>
      <p>z</p>
      <h3>Tab</h3>
      <p>z</p>
      <p><br>
      </p>
      <h3>Profile</h3>
      <p>Lịch sử<br>
      </p>
      <p><br>
      </p>
      <p><br>
      </p>
      <p></p>
      <p><br>
      </p>
      <h3>Google crawler</h3>
      <p>Crawl các domain bằng Google theo từ khóa.</p>
      <h3>Thực thi dạng headless</h3>
      <p>Triển khai trên Linux server, không có giao diện đồ họa.</p>
      <p>Nếu sử dụng FirefoxDriver:</p>
      <pre>driver = new FirefoxDriver();</pre>
      <p>Đầu tiên bị lỗi sau:</p>
      <pre>Exception in thread "main" java.lang.IllegalStateException: The path to the driver executable must be set by the webdriver.gecko.driver system property;
for more information, see https://github.com/mozilla/geckodriver.
The latest version can be downloaded from https://github.com/mozilla/geckodriver/releases</pre>
      <p>Sau khi download file và thêm lệnh:</p>
      <pre>System.setProperty("webdriver.gecko.driver", "/home/huyennv9/crawler-service/geckodriver");</pre>
      <p>Tiếp tục bị lỗi:</p>
      <pre>Error: GDK_BACKEND does not match available displays</pre>
      <p>Dùng lệnh:</p>
      <pre>export DISPLAY=:1</pre>
      <p>cũng không được, do không đúng số màn hình.</p>
      <p>Lệnh trước là:</p>
      <pre>sudo yum -y install firefox Xvfb libXfont Xorg<br>sudo yum -y groupinstall "X Window System" "Desktop" "Fonts" "General Purpose Desktop"<br>Xvfb :99 -ac -screen 0 1280x1024x24 &amp;</pre>
      <p>Cần dùng lệnh:</p>
      <pre>export DISPLAY=:99</pre>
      <p>thì lại bị lỗi:</p>
      <pre>1522980405446	Marionette	INFO	Listening on port 2828
Exception in thread "main" org.openqa.selenium.WebDriverException: connection refused</pre>
      <p>Cuối cùng, sử dụng HtmlUnitDriver (Java).</p>
      <pre>// Để chạy headless (không có GUI) trên Linux phải dùng HtmlUnitDriver
// Phải enable JavaScript và browser version
// driver = new HtmlUnitDriver();
// driver = new HtmlUnitDriver(true);

this.driver = new HtmlUnitDriver(BrowserVersion.CHROME, true);</pre>
      <p>Hiện tại đang phải dùng lệnh export DISPLAY=:99 thì mới chạy được.</p>
      <p>Tuy nhiên, lệnh này đang không được lưu giữa session.</p>
      <h3>Selenium IDE</h3>
      <p>Những cái chúng ta đã học từ đầu gọi là Selenium WebDriver.</p>
      <h3>Selenium Grid</h3>
      <p>x<br>
      </p>
      <p><br>
      </p>
      <p><br>
      </p>
      <p><br>
      </p>
      <h3>Tham khảo</h3>
      <p>Bắt đầu, tổng quan, tiếng Việt cho dễ</p>
      <p><a href="https://en.wikipedia.org/wiki/Selenium_%28software%29" target="_blank">Selenium
          (software) - Wikipedia</a></p>
      <p><a href="https://www.selenium.dev/documentation/en/getting_started/" target="_blank">Getting
          started :: Documentation for Selenium</a></p>
      <p><a href="https://www.howkteam.vn/course/khoa-hoc-selenium-co-ban-den-nang-cao-40"
          target="_blank">Khóa học Selenium cơ bản đến nâng cao | How Kteam</a></p>
      <p>------------------</p>
      <p>Đi sâu<br>
      </p>
      <p><a href="https://viblo.asia/p/selenium-tutorials-31-bai-huong-dan-hoc-selenium-eW65Gx8PKDO?__cf_chl_managed_tk__=076c94e08dd5b71268b7462ff28732e7dbce4705-1625565589-0-ATgIFoSeWHS6yyZxVd6iTRNJ7Kfw_p0RSTCbt5KSS4TQV6nM_OnKTHusyGksmXrTDIJUDb-PDW0-8RRv9s2z_Y-A5PZ-PWrUYLGbaICUXJD5NxdrMJIq6nNqJxr6_bhK5lrVSRWMNVGF2jtZqsNOjHpnXGhrMOgHc-Yb88wNNd8LsRHIp7lw_5LYoa8wRvX1jx7xFmdPzPxoC1gcg1tqwiFfTXOhEoGARScX3N1OkvX98jg2qrv87dICEdx0K1ejKMX3bk31iZaarfR4ptk3OVQe-b8_-uBmnWcUnuZVHr8nYpo1ROw6mnGW_mVbfGOVDzWcQgx4Nx40DntRnVqEVTE_J_QOfVht-JenRQ1WnNObeKxqr75w9F2uNSpTJ6cCaaNqTZEUBKDQ93DyObLByoy_ctBuVAuBu8D8AkFvZvf9FlUSfoso3_GVONKo5t41LrCnHwkkzlTW_4SDv_lMgd8wJqBGalEHrm0HnmabezlbGm_Ck4fbENzf-ipPVzLLvXs3nk5AoqLZDiz_HjpnuTMrXT_pbZvwY9AM6EzA-K-Bl9QBybNcKiHwEfpkLgI4mgYfKzFWcS3LTis0ZsPs6DN6mXoWqZ01NcCgYfa44RZrFdE64AIVXieaV1DY8FQg8xwndIzgQBxYEXEU5bLrCOW-6NXXldqGVSzSp9zujVrXnCnnKhEbX2ku1egLtF9lWCnYLlTGSlDN6qXmUJ0cGhk"
          target="_blank">Selenium Tutorials - 31+ Bài hướng dẫn học Selenium</a></p>
      <p><a href="https://www.softwaretestinghelp.com/selenium-tutorial-1/" target="_blank">30+
          Best Selenium Tutorials: Learn Selenium With Real Examples</a></p>
      <p><a href="https://www.selenium.dev/selenium/docs/api/javascript/index.html"
          target="_blank">JS API reference</a></p>
      <p>(Có thể xem luôn source code ở node_modules)</p>
      <p><a href="https://www.browserstack.com/docs/automate/selenium" target="_blank">Run
          Selenium tests on BrowserStack Automate | BrowserStack Docs</a> </p>
      <p><a href="https://selenium-python.readthedocs.io/" target="_blank">Selenium
          with Python — Selenium Python Bindings 2 documentation</a></p>
      <p><br>
      </p>
      <p><a href="https://github.com/selenium-webdriver-book/manuscript/blob/master/manuscript/ch01_first_steps.adoc"
          target="_blank">manuscript/ch01_first_steps.adoc at master ·
          selenium-webdriver-book/manuscript</a></p>
      <p><br>
      </p>
      <p>Tổng kết</p>
      <p><a href="https://vn.bitdegree.org/huong-dan/selenium-tutorial/" target="_blank">Selenium
          Tutorial: Selenium Webdriver &amp; 30 câu hỏi phỏng vấn phổ biến</a></p>
      <p><br>
      </p>
      <p><br>
      </p>
      <p><br>
      </p>
      <p><br>
      </p>
      <p><br>
      </p>
    </article>
    <script src="../../js/docs.js"></script>
  </body>
</html>
